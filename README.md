Welcome
=====

This is the procedure for Decold in ICPP 2021.
DeCold is tested on Ubuntu 16.04 and our gcc version is 5.4.0.


Preparation
====
 
These are the required libraries that users need to download separately.
Users can use apt-get to install the required libraries.

 - gcc
 - libssl
 - pkg-config
 - gettext
`$ sudo apt-get install gcc libssl-dev pkg-config gettext`


These are the required libraries that users need to install from sourcecode.

**Glib Installation**
Destor is dependent on the glib-2.32.0, so users need install it from sourcecode

    $ wget https://ftp.gnome.org/pub/gnome/sources/glib/2.32/glib-2.32.0.tar.xz
    $ tar -xvf glib-2.32.0.tar.xz
    $ cd glib-2.32.0
    $ ./configure  --prefix=/usr/local
    $ make
    $ make install
    $ cp –r /usr/local/include/glib-2.0/ /usr/local/include/
    $ cp /usr/local/lib/glib-2.0/include/* /usr/local/include/
    $ cp /usr/local/lib/libglib-2.0.so /usr/local/lib/libglib.so

    
**Automake Installation**
Destor is dependent on the automake-1.14

    $ wget ftp://ftp.gnu.org/gnu/automake/automake-1.14.tar.gz
    $ tar -zxvf automake-1.14.tar.gz
    $ cd automake-1.14
    $ ./configure
    $ make
    $ make install
    
**Destor Installation**

    $ git clone https://github.com/fomy/destor.git
    $ cd destor
    $ automake --add-missing
    $ make
    $ make install
    
**RocksDB Installation**

    $ wget https://github.com/facebook/rocksdb/archive/v6.5.2.tar.gz
    $ tar -zxvf v6.5.2.tar.gz
    $ cd rocksdb-6.5.2/
    $ make shared_lib
    $ make install
    



Usage
====

1.Decold Compiling.
	
    `$ make`

2.Use Destor to generate global and group deduplication results. Assume all files are stored in *all_files_path*, the grouped files are stored in *g1_files_path* and *g2_files_path*. In particular, Decold depends on the \**.meta* and \**.recipe* and *container.pool* generated by destor. So users need move these files to one directory.

    $ sh rebuild
    $ ./destor ${g1_files_path}/
    $ mv /home/data/working/recipes/* ${g1_result_path}/
    $ sh rebuild
    $ destor ${g2_files_path}/
    $ mv /home/data/working/recipes/* ${g2_result_path}/
	

3.Decold has some options to set in decold.config

    enable_migration:           # Enable to deduplicate similar files when it equals 1;
    enable_topk: 				# Enable to filtering files when it equals 1;
	big_files					# File threshold, only handle similar files when over the size, the default value is 10240 B.
    migration_threshold:        # File similarity, the default value is 0.8;
    db_path:                    # Rocksdb path, the default value is/tmp/db_path
    db_is_exist:                # If db_is_exist=1, we can reuse the db built，Otherwise, we need to construct rocksdb again, the default value is 1;
    
4.Once the configuration is set up, we can run decold as follows.

    $ ./decold ${g1_result_path}/ ${g2_result_path}/

